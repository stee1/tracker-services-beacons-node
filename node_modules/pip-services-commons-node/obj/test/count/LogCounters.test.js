"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var assert = require('chai').assert;
var LogCounters_1 = require("../../src/count/LogCounters");
var CounterType_1 = require("../../src/count/CounterType");
var DefaultLoggerFactory_1 = require("../../src/log/DefaultLoggerFactory");
var NullLogger_1 = require("../../src/log/NullLogger");
var References_1 = require("../../src/refer/References");
suite('LogCounters', function () {
    var _counters;
    beforeEach(function () {
        var log = new NullLogger_1.NullLogger();
        var refs = References_1.References.fromTuples(DefaultLoggerFactory_1.DefaultLoggerFactory.NullLoggerDescriptor, log);
        _counters = new LogCounters_1.LogCounters();
        _counters.setReferences(refs);
    });
    test('Simple Counters', function () {
        var counters = _counters;
        counters.last("Test.LastValue", 123);
        counters.last("Test.LastValue", 123456);
        var counter = counters.get("Test.LastValue", CounterType_1.CounterType.LastValue);
        assert.isNotNull(counter);
        assert.isNotNull(counter.last);
        assert.equal(counter.last, 123456, 3);
        counters.incrementOne("Test.Increment");
        counters.increment("Test.Increment", 3);
        counter = counters.get("Test.Increment", CounterType_1.CounterType.Increment);
        assert.isNotNull(counter);
        assert.equal(counter.count, 4);
        counters.timestampNow("Test.Timestamp");
        counters.timestampNow("Test.Timestamp");
        counter = counters.get("Test.Timestamp", CounterType_1.CounterType.Timestamp);
        assert.isNotNull(counter);
        assert.isNotNull(counter.time);
        counters.stats("Test.Statistics", 1);
        counters.stats("Test.Statistics", 2);
        counters.stats("Test.Statistics", 3);
        counter = counters.get("Test.Statistics", CounterType_1.CounterType.Statistics);
        assert.isNotNull(counter);
        assert.equal(counter.average, 2, 3);
        counters.dump();
    });
    test('Measure Elapsed Time', function (done) {
        var timer = _counters.beginTiming("Test.Elapsed");
        setTimeout(function () {
            timer.endTiming();
            var counter = _counters.get("Test.Elapsed", CounterType_1.CounterType.Interval);
            console.log(counter.last);
            assert.isTrue(counter.last > 50);
            assert.isTrue(counter.last < 5000);
            _counters.dump();
            done();
        }, 100);
    });
});
//# sourceMappingURL=LogCounters.test.js.map